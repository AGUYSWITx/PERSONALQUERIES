CREATE OR ALTER PROCEDURE WSP_ITEMMASTERLIST
--DECLARE
@ALLOWSTOCK TINYINT=0,--STOCK SHOWING OR NOT
@FYID VARCHAR(25)='%'-- FISCAL YEAR ID

AS

IF @ALLOWSTOCK=1 
BEGIN

select   VW.[Main Group],VW.[SUB GROUP_A],VW.[SUB GROUP_B],VW.[SUB GROUP_C], MI.MCODE,MENUCODE ITEMCODE,DESCA ,DESCB ,BASEUNIT,IIF(VAT=0,'NO','YES')  VATABLE,SUPCODE,ACNAME SUPPLIERNAME ,RATE_A SALESRATE,STOCK,COUNT(*) over() ALLCOUNT
from MENUITEM  MI WITH (nolock) LEFT JOIN vwItemHeirarchy VW ON VW.MCODE=MI.MCODE  
LEFT JOIN RMD_ACLIST RX WITH (nolock) ON RX.ACID=MI.SUPCODE 
LEFT JOIN 

( SELECT MCODE ,SUM (STOCK)STOCK FROM STOCKSUMMARY WHERE PhiscalID=@FYID GROUP BY MCODE )STK ON STK.MCODE=MI.MCODE
WHERE MI.TYPE='A'
 


 END

 ELSE

 select   VW.[Main Group],VW.[SUB GROUP_A],VW.[SUB GROUP_B],VW.[SUB GROUP_C], MI.MCODE,MENUCODE ITEMCODE,DESCA ,DESCB ,BASEUNIT,IIF(VAT=0,'NO','YES')  VATABLE,SUPCODE,ACNAME SUPPLIERNAME ,RATE_A SALESRATE, '' STOCK, COUNT(*)  over() ALLCOUNT
 from MENUITEM  MI WITH (nolock) LEFT JOIN vwItemHeirarchy VW ON VW.MCODE=MI.MCODE  
LEFT JOIN RMD_ACLIST RX WITH (nolock) ON RX.ACID=MI.SUPCODE  
WHERE MI.TYPE='A' 




   